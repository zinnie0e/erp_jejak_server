<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.guru.erpserver.mapper.dbjejak.MonthClosingMapper">

	<!-- 도서별 원가계산서 -->
	<select id="selBookCostStatement1" resultType="monthClosingVO">
		SELECT count(uid) AS count
		FROM TMPLIST2
		WHERE bdate <![CDATA[ > ]]> #{date1}
			AND bdate <![CDATA[ < ]]> #{date2}
		    AND bucode = 0
	</select>
	
	<select id="selBookCostStatement2" resultType="monthClosingVO">
		SELECT a.uid, a.bdate, a.crnum, a.bucode, b.bname, b.bcode, b.bnum
		FROM TMPLIST2 AS a, TMPLIST AS b 
		WHERE a.bdate <![CDATA[ > ]]> #{date1}
			AND a.bdate <![CDATA[ < ]]> #{date2}
		    AND a.bucode = 0 
		    AND a.listid = b.uid 
		ORDER BY a.crnum DESC 
		LIMIT #{lm_s}, #{lm_t}
	</select>
	
	<select id="selBookCostStatement3" resultType="monthClosingVO">
		SELECT count(uid) as yjtag
		FROM TMPLIST3 
		WHERE listid = #{uid}
			AND ycost = 0 
		    AND (jm > 0 or yb > 0)
	</select>
	
	<!-- 잡물 원가계산서 -->
	<select id="selJMCostStatement1" resultType="monthClosingVO">
		SELECT count(uid) AS count 
		FROM TMPJAB 
		WHERE jbdate <![CDATA[ >= ]]> #{date1}
			AND jbdate <![CDATA[ <= ]]> #{date2}
	</select>
	
	<select id="selJMCostStatement2" resultType="monthClosingVO">
		SELECT uid, jbdate, jbname, jbamnt
		FROM TMPJAB 
		WHERE jbdate <![CDATA[ >= ]]> #{date1}
			AND jbdate <![CDATA[ <= ]]> #{date2}
		ORDER BY jbdate ASC
		LIMIT #{lm_s}, #{lm_t}
	</select>
	
	<select id="selJMCostStatement3" resultType="monthClosingVO">
		SELECT count(uid) AS yjtag
		FROM TMPJAB3 
		WHERE jbid = #{uid}
			AND ycost = 0 
			AND (jm > 0 OR yb > 0) 
			AND jutag <![CDATA[ < ]]> 3
	</select>
	
	<!-- 품목별 원재료명세서(월별) -->
	<select id="selPumMon1" resultType="monthClosingVO">
		SELECT * 
		FROM YONGJIMS 
		WHERE msdate = #{msdate}
	</select>
	
	<select id="selPumMon2" resultType="monthClosingVO">
		SELECT wjcode 
		FROM KSWJIJL0 
		ORDER BY ib ASC, wjcode ASC
	</select>
	
	<select id="selPumMon3" resultType="monthClosingVO">
		SELECT a.*, b.wjname 
		FROM YONGJIMS AS a, KSWJIJL0 AS b 
		WHERE a.msdate = #{msdate}
			AND a.yjcode = b.wjcode 
		ORDER BY a.uid ASC
	</select>
	
	<insert id="inPumMon1" parameterType="monthClosingVO">
		INSERT INTO YONGJIMS (
			yjcode, msdate
		) 
		VALUES (
			#{yjcode}, #{msdate}
		)
	</insert>
	
	<!-- 품목별 원재료명세서(기간) -->
	<select id="selPumPer1" resultType="monthClosingVO">
		SELECT a.*, b.wjname 
		FROM YONGJIMS2 AS a, KSWJIJL0 AS b 
		WHERE a.msdate = #{msdate}
			AND a.yjcode = b.wjcode 
		ORDER BY a.uid ASC
	</select>
	
	<!-- 저자료 지급 내역(상/하) -->
	<select id="selRoyaltyUD1" resultType="monthClosingVO">
		SELECT a.sbname, a.sbbook, a.sbinse, a.sbhj04, a.sbhjgb, a.sbuprc
		FROM KSCBOOK0 AS a 
		WHERE a.sbjjgb = 1 
			AND a.${dbattr} <![CDATA[ > ]]> 0 
		ORDER BY a.sbbook ASC
	</select>
	
	<select id="selRoyaltyUD2" resultType="monthClosingVO">
		Select (SELECT sum(s1qnty) FROM KS1${dbname}A WHERE s1gubn = 'C' AND s1book = #{sbbook}) AS sum1, 
			(SELECT sum(s1qnty) FROM KS1${dbname}A WHERE s1gubn = 'D' AND s1book = #{sbbook}) AS sum2
	</select>
	
	<!-- 월별 저자료 지출결의서 -->
	<select id="selMonthlyRoyalty" resultType="monthClosingVO">
		SELECT a.uid, b.bcode, b.bnum, c.sbinse, c.sbjjgb, c.sbjuja, c.sbuprc, c.sbbook, c.sbname
		FROM TMPLIST2 AS a, TMPLIST AS b, KSCBOOK0 AS c
		WHERE (date_format(from_unixtime(a.bdate), '%Y%m') = #{bdate}) 
			AND a.listid = b.uid 
		    AND c.sbbook LIKE b.bcode
		    AND c.sbjjgb = 0
		    AND c.sbinse != 0
		ORDER BY a.bdate ASC
	</select>
	
	<!-- 저자료 지급 내역 ?? -->
	<select id="selRoyalty" resultType="monthClosingVO">
		SELECT a.sbinse, a.sbbook, a.sbname, a.sbuprc, a.sbhjgb,
		    (SELECT SUM(s1qnty) FROM KS1${dbname}A WHERE s1gubn = 'C' AND s1book = a.sbbook) AS sum1,
		    (SELECT SUM(s1qnty) FROM KS1${dbname}A WHERE s1gubn = 'D' AND s1book = a.sbbook) AS sum2
		FROM KSCBOOK0 AS a
		WHERE a.sbbook LIKE '12521%'
			OR a.sbbook LIKE '12522%'
			OR (a.sbbook <![CDATA[ >= ]]> '125340' AND a.sbbook <![CDATA[ <= ]]> '125390')
			OR (a.sbbook <![CDATA[ >= ]]> '125010' AND a.sbbook <![CDATA[ <= ]]> '125050')
			OR a.sbbook LIKE '31134%'
		ORDER BY a.sbbook ASC
	</select>
	
	<!-- 주은교육 제작현황 -->
	<select id="selJueun" resultType="monthClosingVO">
		SELECT a.uid, a.bdate, a.crnum, a.bucode, b.bname, b.bcode, b.bnum , c.sbuprc, c.sbinse
		FROM TMPLIST2 AS a, TMPLIST AS b , KSCBOOK0 AS c
		WHERE a.bdate <![CDATA[ >= ]]> #{date1}
			AND a.bdate <![CDATA[ < ]]> #{date2}
			AND a.bucode=0 
			AND a.listid=b.uid 
			AND b.bcode  <![CDATA[ >= ]]>  "125210"
			AND b.bcode  <![CDATA[ <= ]]>  "125391"
		    AND c.sbbook LIKE b.bcode
		ORDER BY a.crnum DESC
	</select>
	
</mapper>